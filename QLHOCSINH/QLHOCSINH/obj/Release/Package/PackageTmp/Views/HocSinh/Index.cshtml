﻿@{
    ViewBag.Title = "Phương trình bậc 2";
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Enlink - Admin Dashboard Template</title>

    <!-- Favicon -->
    <link rel="shortcut icon" href="~/Content/assets/images/logo/favicon.png">

    <!-- page css -->
    <link href="~/Content/assets/vendors/datatables/dataTables.bootstrap.min.css" rel="stylesheet" />
    <!-- Core css -->
    <link href="~/Content/assets/css/app.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>

    </style>
</head>

<body>
    <div class="app">
        <div class="layout">
            <!-- Page Container START -->
            <div class="page-container">
                <!-- Content Wrapper START -->
                <div class="main-content">
                    <div class="page-header">
                        <div class="card">
                            <div class="card-body">
                                <h3 style="text-align:center; font-weight:bold">DANH SÁCH HỒ SƠ HỌC SINH</h3>
                                <div class="row m-b-30">
                                    <div class="col-lg-2 text-right">
                                        <button class="btn btn-primary btn-tone m-r-5" data-toggle="modal" data-target="#exampleModal">
                                            <i class="anticon anticon-plus-circle m-r-5"></i>
                                            <span>Thêm mới học sinh</span>
                                        </button>
                                    </div>
                                    <div class="col-lg-3">
                                        <div class="input-group">
                                            <label class="text-start" style="font-weight:bold">Search :</label>
                                            <input type="search" class="form-control" id="SearchBox" placeholder="Nhập tên học sinh cần tìm ..." />
                                            <div class="input-group-append">
                                                <button class="btn btn-primary" type="button">
                                                    <i class="anticon anticon-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <select id="ListLop" class="form-control" style="margin-left: 60px; margin-right: 87px; ">
                                        <option value="">-- Chọn lớp --</option>
                                        @foreach (var item in ViewBag.LopList)
                                        {
                                            <option value="@item.Value">@item.Text</option>
                                        }
                                    </select>
                                    <button id="btnSearchbt">Tìm kiếm</button>
                                    <!-- Modal -->
                                    <!--Thêm mới học sinh-->
                                    <div class="modal fade" id="exampleModal">
                                        <div class="modal-dialog">
                                            <div class="modal-content" style="width: 146%; margin-left: -70px; ">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel">TIEP NHAN HO SO HOC SINH</h5>
                                                    <button type="button" class="close" data-dismiss="modal">
                                                        <i class="anticon anticon-close"></i>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="container mt-5" style=" margin-right: 100px; ">
                                                        <div class="border rounded p-4 shadow" style="width: 666px; margin-top: -55px;">
                                                            <h1 class="text-center mb-4" style="font-weight: bold; padding-top: 15px; font-size: 38px;">TIẾP NHẬN HỒ SƠ HỌC SINH</h1>
                                                            <div class="row justify-content-center">
                                                                <div class="col-md-9">
                                                                    <form id="quadratic-form" action="/HocSinh/Add" method="post" style="width: 140%; margin-left: -92px;">
                                                                        <div class="form-title" style="color: blue; margin-bottom: -10px;">Thông tin học sinh</div>
                                                                        <div class="form-group form-inline align-items-center border rounded p-4">
                                                                            <label class="text-start">Mã học sinh :</label>
                                                                            <input type="text" name="MaHS" id="MaHS" class="form form-control" style=" width: 170px; margin-right: 18px;" disabled="" />
                                                                            <label class="text-start">Tên học sinh :</label>
                                                                            <input type="text" name="HoTen" id="HoTen" class="form form-control" />
                                                                            <p id="HoTenError" class="text-danger" style="padding-left: 379px;"></p>
                                                                            <div style=" padding-top: 12px;">
                                                                                <label class="text-start d-inline-block" style="width: 80px;">Ngày sinh :</label>
                                                                                <input type="date" name="NgaySinh" id="NgaySinh" class="form form-control d-inline-block" style="width: 170px; margin-left: 10px; margin-right: 71px;" />
                                                                                <label class="text-start d-inline-block">Nam :</label>
                                                                                <input type="checkbox" name="GioiTinh" id="GioiTinh" value="true" />
                                                                                <p id="NgaySinhError" class="text-danger" style=" padding-left: 95px;"></p>
                                                                            </div>

                                                                            <div style="padding-top: 12px;">
                                                                                <label class="text-start d-inline-block">Địa chỉ :</label>
                                                                                <input type="text" name="DiaChi" id="DiaChi" class="form form-control" style=" margin-left: 34px; width: 490px;" />
                                                                                <p id="DiaChiError" class="text-danger" style="padding-left: 95px;"></p>
                                                                            </div>

                                                                            <div style=" padding-top: 12px;">
                                                                                <label class="text-start d-inline-block">Lớp:</label>
                                                                                <select id="MaLop" name="MaLop" class="form-control" style="margin-left: 60px; margin-right: 87px; ">
                                                                                    <option value="">-- Chọn lớp --</option>
                                                                                    @foreach (var item in ViewBag.LopList)
                                                                                    {
                                                                                        <option value="@item.Value">@item.Text</option>
                                                                                    }
                                                                                </select>

                                                                                <label class="text-start d-inline-block">Điểm TB:</label>
                                                                                <input type="text" name="DiemTB" id="DiemTB" class="form form-control" />
                                                                                <p id="DiemTBError" class="text-danger" style="padding-left: 330px;"></p>
                                                                            </div>

                                                                        </div>

                                                                        <div style="float: right; padding-bottom: 35px;">
                                                                            <button type="button" class="btn btn-primary btn-tone m-r-5" style="width: 122px; height: 42px;" id="btnAdd">
                                                                                <i class="anticon anticon-diff"></i>
                                                                                Thêm mới
                                                                            </button>
                                                                            <button type="reset" class="btn btn-warning btn-tone m-r-5" style="width: 122px; height: 42px;" id="btnReset">
                                                                                <i class="anticon anticon-redo"></i>
                                                                                Reset
                                                                            </button>
                                                                            <button type="reset" class="btn btn-danger btn-tone m-r-5" style="width: 122px; height: 42px;" data-dismiss="modal" id="btnExit">
                                                                                <i class="anticon anticon-logout"></i>
                                                                                Thoát
                                                                            </button>
                                                                        </div>
                                                                    </form>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--Edit học sinh-->
                                    <div class="modal fade" id="EditModal">
                                        <div class="modal-dialog">
                                            <div class="modal-content" style="width: 146%; margin-left: -70px; ">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel">TIEP NHAN HO SO HOC SINH</h5>
                                                    <button type="button" class="close" data-dismiss="modal">
                                                        <i class="anticon anticon-close"></i>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="container mt-5" style=" margin-right: 100px; ">
                                                        <div class="border rounded p-4 shadow" style="width: 666px; margin-top: -55px;">
                                                            <h1 class="text-center mb-4" style="font-weight: bold; padding-top: 15px; font-size: 38px;">TIẾP NHẬN HỒ SƠ HỌC SINH</h1>
                                                            <div class="row justify-content-center">
                                                                <div class="col-md-9">
                                                                    <form id="quadratic-form" action="/HocSinh/Edit" method="post" style="width: 140%; margin-left: -92px;">
                                                                        <div class="form-title" style="color: blue; margin-bottom: -10px;">Thông tin học sinh</div>
                                                                        <div class="form-group form-inline align-items-center border rounded p-4">
                                                                            <label class="text-start">Mã học sinh :</label>
                                                                            <input type="text" name="EditMaHS" id="EditMaHS" class="form form-control" style=" width: 170px; margin-right: 18px;" disabled="" />
                                                                            <label class="text-start">Tên học sinh :</label>
                                                                            <input type="text" name="EditHoTen" id="EditHoTen" class="form form-control" />
                                                                            <p id="EditHoTenError" class="text-danger" style="padding-left: 379px;"></p>
                                                                            <div style=" padding-top: 12px;">
                                                                                <label class="text-start d-inline-block" style="width: 80px;">Ngày sinh :</label>
                                                                                <input type="date" name="EditNgaySinh" id="EditNgaySinh" class="form form-control d-inline-block" style="width: 170px; margin-left: 10px; margin-right: 71px;" />
                                                                                <label class="text-start d-inline-block">Nam :</label>
                                                                                <input type="checkbox" name="EditGioiTinh" id="EditGioiTinh" value="true" />
                                                                                <p id="EditNgaySinhError" class="text-danger" style=" padding-left: 95px;"></p>
                                                                            </div>

                                                                            <div style="padding-top: 12px;">
                                                                                <label class="text-start d-inline-block">Địa chỉ :</label>
                                                                                <input type="text" name="EditDiaChi" id="EditDiaChi" class="form form-control" style=" margin-left: 34px; width: 490px;" />
                                                                                <p id="EditDiaChiError" class="text-danger" style="padding-left: 95px;"></p>
                                                                            </div>

                                                                            <div style=" padding-top: 12px;">
                                                                                <label class="text-start d-inline-block">Lớp:</label>
                                                                                <select id="EditMaLop" name="EditMaLop" class="form-control" style="margin-left: 60px; margin-right: 87px; ">
                                                                                    <option value="">-- Chọn lớp --</option>
                                                                                    @foreach (var item in ViewBag.LopList)
                                                                                    {
                                                                                        <option value="@item.Value">@item.Text</option>
                                                                                    }
                                                                                </select>
                                                                                <label class="text-start d-inline-block">Điểm TB:</label>
                                                                                <input type="text" name="EditDiemTB" id="EditDiemTB" class="form form-control" />
                                                                                <p id="EditDiemTBError" class="text-danger" style="padding-left: 330px;"></p>
                                                                            </div>

                                                                        </div>

                                                                        <div style="float: right; padding-bottom: 35px;">
                                                                            <button type="button" class="btn btn-primary btn-tone m-r-5" style="width: 122px; height: 42px;" id="btnSaveEdit">
                                                                                <i class="anticon anticon-form"></i>
                                                                                Sửa
                                                                            </button>
                                                                            <button type="reset" class="btn btn-danger btn-tone m-r-5" style="width: 122px; height: 42px;" data-dismiss="modal" id="btnExitEdit">
                                                                                <i class="anticon anticon-logout"></i>
                                                                                Thoát
                                                                            </button>
                                                                        </div>
                                                                    </form>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="table-responsive">
                                    <table class="table table-hover e-commerce-table">
                                        <thead>
                                            <tr>
                                                <th>STT</th>
                                                <th>Mã học sinh</th>
                                                <th>Tên Học Sinh</th>
                                                <th>Ngày sinh</th>
                                                <th>Giới tính</th>
                                                <th>Địa chỉ</th>
                                                <th>Lớp</th>
                                                <th>Điểm TB</th>
                                                <th>Chức năng</th>
                                            </tr>
                                        </thead>
                                        <tbody id="showdata">
                                        </tbody>
                                    </table>
                                    <div id="pagination"></div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="~/Content/assets/js/vendors.min.js"></script>
    <script src="~/Content/assets/js/app.min.js"></script>
    <script>

        $(document).ready(function () {
            LoadData("");
            XuLyNhapLieuADD();
            XuLyNhapLieuEdit();
            $("#SearchBox").on('keyup input', debounce(function () {
                var txtsearch = $(this).val();
                var selectedClass = $("#ListLop").val();
                LoadData(txtsearch, selectedClass);
            }, 1000));
            $("#btnSearchbt").click(function () {
                var selectedClass = $("#ListLop").val();
                var txtsearch = $("#SearchBox").val();
                LoadData(txtsearch, selectedClass);
            });

            $('#GioiTinh').change(function () {
                if ($(this).is(':checked')) {
                    // Nếu giới tính là Nam, ẩn điểm trung bình
                    $('#DiaChi').parent().hide();
                } else {
                    // Nếu giới tính là Nữ, hiện điểm trung bình
                    $('#DiaChi').parent().show();
                }
            });
            $("#btnAdd").click(function () {
                AddHocSinh();
            });
            $(document).on("click", ".btnEdit", function () {
                var MaHS = $(this).closest("tr").find("td:eq(1)").text();
                GetById(MaHS);
            });
            $('#exampleModal').on('show.bs.modal', function (e) {
                TangID();
            });

            $("#btnSaveEdit").click(function () {
                UpdateHS();
            });
            $(document).on("click", ".btnDelete", function () {
                var id = $(this).closest("tr").find("td:eq(1)").text();
                var name = $(this).closest("tr").find("td:eq(2)").text();
                if (confirm("Bạn có chắc muốn xóa học sinh '" + name + "'không?")) {
                    DeleteHocSinh(id);
                }
            });

            $('#exampleModal').on('hidden.bs.modal', function () {
                $('#quadratic-form input[type="text"]').val('');
                $('#quadratic-form input[type="date"]').val('');
                $('#quadratic-form select').val('');
                $('#quadratic-form input[type="checkbox"]').prop('checked', false);
            });

            $('#btnReset').click(function () {
                resetForm();
            });
            $('#btnExitEdit').click(function () {
                resetError();
            });
            $('#btnExit').click(function () {
                resetForm();
            });

        });

        function GetById(MaHS) {
            $.ajax({
                url: '/HocSinh/GetById',
                type: 'GET',
                data: { MaHS: MaHS },
                success: function (res) {
                    $('#EditMaHS').val(res.data.MaHS);
                    $('#EditHoTen').val(res.data.HoTen);
                    $('#EditNgaySinh').val(res.data.NgaySinh);
                    $('#EditGioiTinh').prop('checked', res.data.GioiTinh);
                    $('#EditDiaChi').val(res.data.DiaChi);
                    $('#EditMaLop').val(res.data.MaLop);
                    $('#EditDiemTB').val(res.data.DiemTB);
                }
            });
        };
        function TangID() {
            $.ajax({
                url: '/HocSinh/GetMaxMaHS',
                type: 'GET',
                success: function (data) {
                    var maxId = data.maxId;
                    // Tăng ID lên 1 và gán vào trường MaHS
                    var newId = "HS" + (maxId + 1);
                    $('#MaHS').val(newId);
                }
            });
        };

        function debounce(func, delay) {
            let timeoutId;
            return function () {
                const context = this;
                const args = arguments;
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => func.apply(context, args), delay);
            };
        }

        function LoadData(searchName, malop) {
            $.ajax({
                url: '/HocSinh/GetHocSinh',
                type: 'GET',
                data: { searchName: searchName, malop: malop },
                success: function (res) {
                    var items = res.data;
                    var html = "";
                    if (items.length === 0) {
                        html += "<tr><td colspan='9' class='text-center'>Không có dữ liệu</td></tr>";
                    } else {
                        for (let i = 0; i < items.length; i++) {
                            var ngaySinh = new Date(parseInt(items[i].NgaySinh.substr(6)));
                            var formattedDate = ngaySinh.getDate() + '-' + (ngaySinh.getMonth() + 1) + '-' + ngaySinh.getFullYear();
                            var index = i + 1;
                            html += "<tr>";
                            html += "<td>" + index + "</td>"
                            html += "<td>" + items[i].MaHS + "</td>";
                            html += "<td>" + items[i].HoTen + "</td>";
                            html += "<td>" + formattedDate + "</td>";
                            html += "<td>" + items[i].GioiTinh + "</td>";
                            html += "<td>" + items[i].DiaChi + "</td>";
                            html += "<td>" + items[i].Lop + "</td>";
                            html += "<td>" + items[i].DiemTB + "</td>";
                            html += "<td><button class='btn btn-icon btn-hover btn-sm btn-rounded pull-right btnEdit' data-toggle='modal' data-target='#EditModal'> <i class='anticon anticon-edit'></i></button><button class='btn btn-icon btn-hover btn-sm btn-rounded pull-right btnDelete'> <i class='anticon anticon-delete'></i></button> </td> ";
                            html += "</tr>";
                        }
                    }
                    $('#showdata').html(html);
                }
            });
        };

        function AddHocSinh() {
            var MaHS = $('#MaHS').val().trim();
            var HoTen = $('#HoTen').val().trim();
            var NgaySinh = $('#NgaySinh').val();
            var GioiTinh = $('#GioiTinh').is(':checked');
            var DiaChi = $('#DiaChi').val().trim();
            var MaLop = $('#MaLop').val();
            var DiemTB = $('#DiemTB').val().trim();
            if (!HoTen) {
                $('#HoTenError').text('Họ và tên là trường bắt buộc');
                return;
            }
            else if (!NgaySinh) {
                $('#NgaySinhError').text('Ngày sinh là trường bắt buộc');
                return;
            }
            else if (!DiaChi) {
                $('#DiaChiError').text('Địa chỉ là trường bắt buộc');
                return;
            }
            else if (!DiemTB) {
                $('#DiemTBError').text('Điểm trung bình là trường bắt buộc');
                return;
            }


            $.ajax({
                type: 'POST',
                url: '/HocSinh/Add',
                dataType: 'JSON',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({
                    MaHS: MaHS,
                    HoTen: HoTen,
                    NgaySinh: NgaySinh,
                    GioiTinh: GioiTinh,
                    DiaChi: DiaChi,
                    MaLop: MaLop,
                    DiemTB: DiemTB
                }),
                success: function (response) {
                    alert(response.status);
                    LoadData();
                },
                error: function (response) {
                    alert(response.status)
                },
            });
        };

        function UpdateHS() {
            var HoTen = $('#EditHoTen').val();
            if (HoTen.trim() === '') {
                $('#EditHoTenError').text('Họ và tên là trường bắt buộc');
                return;
            }
            var NgaySinh = $('#EditNgaySinh').val();
            if (NgaySinh.trim() === '') {
                $('#EditNgaySinhError').text('Ngày Sinh là trường bắt buộc');
                return;
            }
            var DiaChi = $('#EditDiaChi').val();
            if (DiaChi.trim() === '') {
                $('#EditDiaChiError').text('Địa chỉ là trường bắt buộc');
                return;
            }
            var DiemTB = $('#EditDiemTB').val();
            if (DiemTB.trim() === '') {
                $('#EditDiemTBError').text('Điểm trung bình là trường bắt buộc');
                return;
            }
            var Hs = {
                MaHS: $('#EditMaHS').val(),
                HoTen: HoTen,
                NgaySinh: NgaySinh,
                GioiTinh: $('#EditGioiTinh').is(':checked'),
                DiaChi: DiaChi,
                MaLop: $('#EditMaLop').val(),
                DiemTB: DiemTB,
            };

            $.ajax({
                type: 'POST',
                url: '/HocSinh/Edit',
                dataType: 'JSON',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(Hs),
                success: function (response) {
                    alert(response.status);
                    LoadData();
                },
            });
        };

        function DeleteHocSinh(id) {
            $.ajax({
                type: 'POST',
                url: '/HocSinh/Delete',
                data: { id: id },
                success: function (response) {
                    alert(response.status);
                    LoadData();
                },
            });
        };
        function resetForm() {
            $('#quadratic-form input[type="text"]').not('#MaHS').val('');
            $('#quadratic-form input[type="date"]').val('');
            $('#quadratic-form select').val('');
            $('#quadratic-form input[type="checkbox"]').prop('checked', false);

            $('#HoTenError').text('');
            $('#NgaySinhError').text('');
            $('#DiaChiError').text('');
            $('#DiemTBError').text('');


            TangID();
        };
        function resetError() {
            $('#EditHoTenError').text('');
            $('#EditNgaySinhError').text('');
            $('#EditDiaChiError').text('');
            $('#EditDiemTBError').text('');
        };
        function XuLyNhapLieuADD() {
            // Xử lý sự kiện khi nhập liệu vào ô
            $('#HoTen').on('input', function () {
                $('#HoTenError').text('');
            });
            $('#NgaySinh').on('input', function () {
                $('#NgaySinhError').text('');
            });

            $('#DiaChi').on('input', function () {
                $('#DiaChiError').text('');
            });
            // Sự kiện rời khỏi ô báo lỗi
            $('#HoTen').on('blur', function () {
                var inputValue = $(this).val().trim();
                if (!inputValue) {
                    $('#HoTenError').text('Họ và tên là trường bắt buộc');
                } else {
                    $('#HoTenError').text('');
                }
            });
            $('#NgaySinh').on('blur', function () {
                var inputValue = $(this).val().trim();
                if (!inputValue) {
                    $('#NgaySinhError').text('Ngày sinh là trường bắt buộc');
                } else {
                    $('#NgaySinhError').text('');
                }
            });
            $('#DiaChi').on('blur', function () {
                var inputValue = $(this).val().trim();
                if (!inputValue) {
                    $('#DiaChiError').text('Địa chỉ là trường bắt buộc');
                } else {
                    $('#DiaChiError').text('');
                }
            });
            $('#DiemTB').on('blur', function () {
                var inputValue = $(this).val().trim();
                if (!inputValue) {
                    $('#DiemTBError').text('Điểm trung bình là trường bắt buộc');
                } else {
                    $('#DiemTBError').text('');
                }
            });
        };

        function XuLyNhapLieuEdit() {
            // Xử lý sự kiện khi nhập liệu vào ô
            $('#EditHoTen').on('input', function () {
                $('#EditHoTenError').text('');
            });
            $('#EditNgaySinh').on('input', function () {
                $('#EditNgaySinhError').text('');
            });

            $('#EditDiaChi').on('input', function () {
                $('#EditDiaChiError').text('');
            });
            // Sự kiện rời khỏi ô báo lỗi
            $('#EditHoTen').on('blur', function () {
                var inputValue = $(this).val().trim();
                if (!inputValue) {
                    $('#EditHoTenError').text('Họ và tên là trường bắt buộc');
                } else {
                    $('#EditHoTenError').text('');
                }
            });
            $('#EditNgaySinh').on('blur', function () {
                var inputValue = $(this).val().trim();
                if (!inputValue) {
                    $('#EditNgaySinhError').text('Ngày sinh là trường bắt buộc');
                } else {
                    $('#EditNgaySinhError').text('');
                }
            });
            $('#EditDiaChi').on('blur', function () {
                var inputValue = $(this).val().trim();
                if (!inputValue) {
                    $('#EditDiaChiError').text('Địa chỉ là trường bắt buộc');
                } else {
                    $('#EditDiaChiError').text('');
                }
            });
            $('#EditDiemTB').on('blur', function () {
                var inputValue = $(this).val().trim();
                if (!inputValue) {
                    $('#EditDiemTBError').text('Điểm trung bình là trường bắt buộc');
                } else {
                    $('#EditDiemTBError').text('');
                }
            });
        };

    </script>
</body>
</html>